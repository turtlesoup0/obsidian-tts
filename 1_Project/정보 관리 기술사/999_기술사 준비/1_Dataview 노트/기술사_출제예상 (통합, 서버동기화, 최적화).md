---
í•´ì‹œíƒœê·¸: "#ê²€ìƒ‰ì œì™¸"
---

> **ğŸ“ í•™ìŠµ ì§„í–‰ ìƒí™© ì¶”ì **
> - ìˆ˜ë™ ì €ì¥: ìš°í•˜ë‹¨ ğŸ“ ì €ì¥ ë²„íŠ¼ í´ë¦­
> - ìœ„ì¹˜ ì´ë™: ğŸ¯ ì´ë™ ë²„íŠ¼ í´ë¦­ì‹œ ì €ì¥ëœ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¡œ ì´ë™
> - TTS ìœ„ì¹˜: ğŸ™ï¸ ë²„íŠ¼ í´ë¦­ì‹œ ë§ˆì§€ë§‰ TTS ì¬ìƒ ìœ„ì¹˜ë¡œ ì´ë™
> - **â˜ï¸ ì„œë²„ ê¸°ë°˜ ë™ê¸°í™”**: ğŸ¯/ğŸ™ï¸ ë²„íŠ¼ í´ë¦­ ì‹œ ì„œë²„ì—ì„œ ìµœì‹  ìœ„ì¹˜ ì¡°íšŒ
> - **ğŸ“± ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ**: í™”ë©´ í¬ê¸°ì— ë”°ë¼ ìë™ ì¡°ì • (ì•„ì´íŒ¨ë“œ ë¯¸ë‹ˆëŠ” 2ì»¬ëŸ¼)
> - **âš¡ ì„±ëŠ¥ ìµœì í™”**: Lazy Loading, DOM ìºì‹±, ì´ë²¤íŠ¸ ìœ„ì„

- "ê¸°ìˆ ì‚¬" ë€ í•´ë‹¹ ê¸°ìˆ  ë¶„ì•¼ì— ê´€í•œ ê³ ë„ì˜ **ì „ë¬¸ì§€ì‹**ê³¼ *ì‹¤ë¬´ê²½í—˜*ì— ì…ê°í•œ **ì‘ìš©ëŠ¥ë ¥**ì„ ë³´ìœ í•œ ì‚¬ëŒìœ¼ë¡œì„œ, **êµ­ê°€ê¸°ìˆ ìê²©ë²• ì œ10ì¡°**ì— ë”°ë¼ *ê¸°ìˆ ì‚¬ ìê²©*ì„ *ì·¨ë“í•œ ì‚¬ëŒ*ì„ ë§í•œë‹¤.

# ë§í¬
## ì°¸ê³ ìë£Œ
- [[0_ê¸°ìˆ ì‚¬ í™œìš© ë©”íƒ€]]
- [[ë©˜í† ë§ ë…¸íŠ¸]]

## ë„ë©”ì¸ ë³„ êµ¬ì„±
- [[SW]]
- [[ê²½ì˜ ê´€ë¦¬]]
- [[ë°ì´í„°ë² ì´ìŠ¤]]
- [[ë¹…ë°ì´í„°_ì¸ê³µì§€ëŠ¥ (AI, Artifical Intelligent)]]
- [[ì‹ ê¸°ìˆ ]]
- [[ë„¤íŠ¸ì›Œí¬]]
- [[ë°ì´í„° ë¶„ì„]]
- [[ì •ë³´ë³´ì•ˆ (Security)]]
- [[CA OS]]

## ìš©ë„ë³„ êµ¬ì„±
- [[í‘œì¤€ ëª¨ìŒ (De Jure)]]
- [[ê·œì •, ê°€ì´ë“œ, ë²• ê°œì •ì•ˆ ëª¨ìŒ]]
- [[ê°€íŠ¸ë„ˆ íŠ¸ë Œë“œ ìš©ì–´]]

# Dataview

```dataviewjs
// ================================================================
// [ì‹¤í—˜] Dataview ì¦ë¶„ ê°±ì‹  í…ŒìŠ¤íŠ¸ (Phase 1)
// ëª©ì : container.innerHTML="" í›„ ìºì‹œëœ DOM ì¬ë¶€ì°© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
// ê²°ê³¼ í™•ì¸: Obsidian ê°œë°œì ì½˜ì†” (Ctrl+Shift+I)
// ì œê±° ì‹œì : ì‹¤í—˜ ì™„ë£Œ í›„ ì‚­ì œ
// ================================================================
if (window._dvRerenderTest) {
    const t = window._dvRerenderTest;
    const containerSame = (t.container === dv.container);
    const tableConnected = t.table?.isConnected;
    console.log('ğŸ”„ [DV-TEST] ì¬ì‹¤í–‰ ê°ì§€');
    console.log('  container ë™ì¼?', containerSame);
    console.log('  ìºì‹œ í…Œì´ë¸” DOM ì—°ê²°?', tableConnected);

    // ìºì‹œëœ í…Œì´ë¸”ì„ (ë¹„ì›Œì§„) containerì— ì¬ë¶€ì°©
    if (t.table) {
        dv.container.appendChild(t.table);
        console.log('  ì¬ë¶€ì°© í›„ ì—°ê²°?', t.table.isConnected);
        console.log('  í–‰ ìˆ˜:', t.table.querySelectorAll('tbody tr').length);
    }

    // ë‚˜ë¨¸ì§€ ì½”ë“œ ì „ì²´ ìŠ¤í‚µ í…ŒìŠ¤íŠ¸
    console.log('  returnìœ¼ë¡œ ì½”ë“œë¸”ë¡ ì¢…ë£Œ ì‹œë„...');
    return;
}

// ================================================================
// ğŸ§© ê³µìœ  ëª¨ë“ˆ ë¡œë”©
// ================================================================
await dv.view("views/tts-core");
await dv.view("views/tts-config");  // ğŸ”‘ Config ë¡œë“œ (í•„ìˆ˜)
await dv.view("views/tts-bell");
await dv.view("views/sse-sync");    // ğŸš€ SSE ì‹¤ì‹œê°„ ë™ê¸°í™” (SPEC-PERF-001)

// ================================================================
// [1] ì„¤ì • (Configuration) - ë™ì  ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
// ================================================================
const getAzureFunctionUrl = () => {
    // tts-configì—ì„œ ì„¤ì •ëœ URL ì‚¬ìš© (ìš°ì„ ìˆœìœ„: config > localStorage > ê¸°ë³¸ê°’)
    if (window.ttsEndpointConfig?.azureFunctionUrl) {
        return window.ttsEndpointConfig.azureFunctionUrl;
    }
    if (window.ACTIVE_BASE_URL) {
        return window.ACTIVE_BASE_URL;
    }
    // í´ë°±: ê¸°ë³¸ Azure Function URL
    return 'https://obsidian-tts-func-hwh0ffhneka3dtaa.koreacentral-01.azurewebsites.net';
};

const CONFIG = {
    EXAM_RANGE: { start: 134, end: 137 },
    AZURE_FUNCTION_URL: getAzureFunctionUrl(),  // ë™ì  ì„¤ì • ì‚¬ìš©
    BREAKPOINTS: { mobile: 768, tablet: 1150 },
    SEARCH_DEBOUNCE_MS: 300,
    RESIZE_DEBOUNCE_MS: 500,
    STYLE_ID: 'integrated-note-style',
};
window.ttsLog('âœ… [í†µí•©ë…¸íŠ¸] CONFIG ë¡œë“œ ì™„ë£Œ');
window.ttsLog('âœ… [í†µí•©ë…¸íŠ¸] Azure Function URL (ë™ì ):', CONFIG.AZURE_FUNCTION_URL);

// ================================================================
// ğŸ§© ìŠ¤í¬ë¡¤ ë§¤ë‹ˆì € ëª¨ë“ˆ ë¡œë”©
// ================================================================
await dv.view("views/scroll-manager", { config: CONFIG });

// ================================================================
// ğŸš€ SSE ì‹¤ì‹œê°„ ë™ê¸°í™” ì´ˆê¸°í™” (SPEC-PERF-001)
// ================================================================
if (window.sseSyncManager) {
    const edgeServerUrl = window.ObsidianTTSConfig?.edgeServerUrl
        || window.ttsEndpointConfig?.edgeServerUrl
        || 'http://100.107.208.106:5051';

    window.sseSyncManager.init(edgeServerUrl).then(success => {
        if (success) {
            console.log('âœ… [í†µí•©ë…¸íŠ¸] SSE ëª¨ë“œ í™œì„±í™” - ì‹¤ì‹œê°„ ë™ê¸°í™”');
        } else {
            console.log('âš ï¸ [í†µí•©ë…¸íŠ¸] SSE ë¶ˆê°€ - í´ë§ ëª¨ë“œ ì‚¬ìš©');
        }
    });
} else {
    window.ttsLog?.('âš ï¸ [í†µí•©ë…¸íŠ¸] sseSyncManager ì—†ìŒ - SSE ë¹„í™œì„±í™”');
}

// TTS ì¬ìƒ ìœ„ì¹˜ ì½ê¸° ì—”ë“œí¬ì¸íŠ¸ (tts-position ëª¨ë“ˆê³¼ ë™ì¼í•œ ë™ì  ì„¤ì • ì‚¬ìš©)
const TTS_POSITION_READ_ENDPOINT = CONFIG.AZURE_FUNCTION_URL + '/api/playback-position';

// ê²€ì¦ ë¡œê·¸: TTS v5ì™€ í†µí•© ë…¸íŠ¸ê°€ ë™ì¼í•œ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸
if (window.playbackPositionManager?.apiEndpoint) {
    const ttsV5Endpoint = window.playbackPositionManager.apiEndpoint;
    const match = (ttsV5Endpoint === TTS_POSITION_READ_ENDPOINT);
    window.ttsLog('âœ… TTS Position Read Endpoint (í†µí•© ë…¸íŠ¸):', TTS_POSITION_READ_ENDPOINT);
    window.ttsLog('âœ… TTS v5 Endpoint:', ttsV5Endpoint);
    window.ttsLog(match ? 'âœ… ì—”ë“œí¬ì¸íŠ¸ ì¼ì¹˜ í™•ì¸!' : 'âš ï¸ ì—”ë“œí¬ì¸íŠ¸ ë¶ˆì¼ì¹˜ ê°ì§€!', {
        integrated: TTS_POSITION_READ_ENDPOINT,
        ttsV5: ttsV5Endpoint
    });
} else {
    window.ttsLog('âœ… TTS Position Read Endpoint (í†µí•© ë…¸íŠ¸):', TTS_POSITION_READ_ENDPOINT);
    window.ttsLog('âš ï¸ TTS v5 ëª¨ë“ˆì´ ì•„ì§ ë¡œë“œë˜ì§€ ì•ŠìŒ (ì—”ë“œí¬ì¸íŠ¸ ë¹„êµ ë¶ˆê°€)');
}

// ================================================================
// [2] ë°ì´í„° ì¿¼ë¦¬
// ================================================================
let TAG_QUERY = '#ì¶œì œì˜ˆìƒ';
for (let i = CONFIG.EXAM_RANGE.start; i <= CONFIG.EXAM_RANGE.end; i++) {
    TAG_QUERY += ` or #${i}ê´€ or #${i}ì‘`;
}

const pages = dv.pages(`"1_Project/ì •ë³´ ê´€ë¦¬ ê¸°ìˆ ì‚¬" and -#ê²€ìƒ‰ì œì™¸ and (${TAG_QUERY})`)
    .sort(b => [b.file.folder, b.file.name], 'asc');

const syncedPosition = window.scrollPositionManager
    ? await window.scrollPositionManager.syncPosition()
    : { noteName: localStorage.getItem('scroll_lastNoteName') || '', noteIndex: parseInt(localStorage.getItem('scroll_lastNoteIndex') || '-1', 10) };
const savedNoteName = syncedPosition.noteName || '';

// ================================================================
// [3] ê²€ìƒ‰/í•„í„° ì—”ì§„
// ================================================================
const domainSet = new Set();
const pageFolders = [];
pages.forEach(p => {
    const folder = p.file.folder;
    pageFolders.push(folder);
    const parts = folder.split('/');
    const domainIdx = parts.indexOf('ì •ë³´ ê´€ë¦¬ ê¸°ìˆ ì‚¬');
    if (domainIdx >= 0 && parts.length > domainIdx + 1) {
        domainSet.add(parts[domainIdx + 1]);
    }
});
const domains = [...domainSet].sort();

// ================================================================
// [4] ë ˆì´ì•„ì›ƒ & ë Œë”ë§
// ================================================================
const getLayoutMode = () => {
    const width = window.innerWidth;
    if (width < CONFIG.BREAKPOINTS.mobile) return 'mobile';
    if (width < CONFIG.BREAKPOINTS.tablet) return 'tablet';
    return 'desktop';
};

const pageNames = [];
let bookmarkIndex = -1;
let currentLayoutMode = getLayoutMode();
window.ttsLog(`ğŸ“Š ì´ ${pages.length}ê°œ ë…¸íŠ¸ ë Œë”ë§ ì‹œì‘ (ë ˆì´ì•„ì›ƒ: ${currentLayoutMode})`);

// í•­ìƒ 3ì»¬ëŸ¼ ë°ì´í„° ìƒì„± (CSSê°€ ë ˆì´ì•„ì›ƒ ëª¨ë“œì— ë”°ë¼ í‘œì‹œ/ìˆ¨ê¹€)
const tableRows = pages.map((p, idx) => {
    pageNames.push(p.file.name);
    if (savedNoteName && p.file.name === savedNoteName) bookmarkIndex = idx;

    const prefix = (idx === bookmarkIndex) ? "ğŸ“ **[ì—¬ê¸°ë¶€í„°]**<br><br>" : "";

    // ===== ì´ë¯¸ì§€ ì²˜ë¦¬ (Dataview Link ê°ì²´ ì§€ì›) =====
    // ëª¨ë°”ì¼(1ì»¬ëŸ¼)ì—ì„œëŠ” ì¦‰ì‹œ ë¡œë“œ, PCì—ì„œëŠ” Lazy Loading
    const isMobile = window.innerWidth < CONFIG.BREAKPOINTS.mobile;
    let imageContent = '';
    if (p.ì´ë¯¸ì§€) {
        try {
            const imageLinks = Array.isArray(p.ì´ë¯¸ì§€) ? p.ì´ë¯¸ì§€ : [p.ì´ë¯¸ì§€];

            const imageHtmls = imageLinks.map(imgLink => {
                // Dataview Link ê°ì²´ í™•ì¸ ë° ê²½ë¡œ ì¶”ì¶œ
                const imagePath = imgLink?.path;
                if (!imagePath) return '';

                // app ê°ì²´ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
                if (typeof app === 'undefined' || !app?.vault) {
                    console.warn('[ì´ë¯¸ì§€] app ê°ì²´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return '';
                }

                // TFile ê°ì²´ ê°€ì ¸ì˜¤ê¸° (pathëŠ” ìƒëŒ€ ê²½ë¡œ)
                const linkDest = app.metadataCache.getFirstLinkpathDest(imagePath, p.file.path);
                if (!linkDest) {
                    console.warn('[ì´ë¯¸ì§€] íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:', imagePath);
                    return '';
                }

                // ë¦¬ì†ŒìŠ¤ ê²½ë¡œ ìƒì„±
                const imgPath = app.vault.getResourcePath(linkDest);

                // ëª¨ë°”ì¼: ì¦‰ì‹œ ë¡œë“œ, PC: Lazy Loading
                if (isMobile) {
                    return `<img src="${imgPath}" decoding="async" style="max-width:100%;height:auto;display:block;margin-top:8px">`;
                } else {
                    return `<img class="lazy-image" data-src="${imgPath}" data-row="${idx}" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" style="max-width:100%;height:auto;display:block;min-height:150px;background:var(--background-modifier-border)">`;
                }
            }).filter(html => html);

            imageContent = imageHtmls.join('<br>');
        } catch (err) {
            console.error('[ì´ë¯¸ì§€] ì²˜ë¦¬ ì˜¤ë¥˜:', err);
            imageContent = '';
        }
    }

    const keywordText = Array.isArray(p.í‚¤ì›Œë“œ) ? p.í‚¤ì›Œë“œ.join('<br>') : (p.í‚¤ì›Œë“œ || '');

    const col1 = `${prefix}[[${p.file.name}]]<br><br>${p.ë¦¬ë“œë¬¸}<br><br>${p.ì •ì˜}<br><br>${p.í•´ì‹œíƒœê·¸}`
        + (imageContent ? `<div class="in-inline-media">${imageContent}</div>` : '')
        + (keywordText ? `<div class="in-inline-keywords">---<br>${keywordText}</div>` : '');

    const col2 = keywordText
        + (imageContent ? `<div class="in-col2-media"><br>${imageContent}</div>` : '');

    const col3 = imageContent || '';

    return [col1, col2, col3];
});

window.currentPageNames = pageNames;
window._integratedNotePageFolders = pageFolders;

// í•­ìƒ 3ì»¬ëŸ¼ìœ¼ë¡œ ë Œë”ë§
dv.table(["íŒŒì¼ëª…", "í‚¤ì›Œë“œ", "ì´ë¯¸ì§€"], tableRows);

// ì €ì‚¬ì–‘ ë””ë°”ì´ìŠ¤ ê°ì§€
const isLowEndDevice = () => {
    const canvas = document.createElement('canvas');
    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
    if (!gl) return true;
    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
    if (debugInfo) {
        const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
        if (/Adreno \(TM\) [3-4]\d\d|Mali-[4-5]\d\d/i.test(renderer)) return true;
    }
    if (navigator.hardwareConcurrency && navigator.hardwareConcurrency <= 4) return true;
    return false;
};
const lowEndMode = isLowEndDevice();
window.lowEndMode = lowEndMode;
window.ttsLog(`ğŸ“± ë””ë°”ì´ìŠ¤ ëª¨ë“œ: ${lowEndMode ? 'ì €ì‚¬ì–‘ ìµœì í™”' : 'ê³ ì„±ëŠ¥'}`);

// ================================================================
// ğŸ§© UI ëª¨ë“ˆ ë¡œë”©
// ================================================================
await dv.view("views/integrated-ui", {
    config: CONFIG,
    domains,
    lowEndMode,
    getLayoutMode,
    TTS_POSITION_READ_ENDPOINT,
    bookmarkIndex,
    pages: pages.array(),
    savedNoteName,
    dv
});

// ================================================================
// [ì‹¤í—˜] ìºì‹œ ì €ì¥ (Phase 1 í…ŒìŠ¤íŠ¸)
// dv.table()ì´ DOMì„ ì™„ì„±í•œ í›„ ì €ì¥ (3ì´ˆ ëŒ€ê¸°)
// ================================================================
setTimeout(() => {
    const table = dv.container.querySelector('.table-view-table');
    if (table) {
        window._dvRerenderTest = {
            container: dv.container,
            table: table
        };
        console.log('ğŸ“Œ [DV-TEST] ìºì‹œ ì €ì¥ ì™„ë£Œ', {
            rows: table.querySelectorAll('tbody tr').length,
            containerConnected: dv.container.isConnected
        });
    } else {
        console.warn('âš ï¸ [DV-TEST] í…Œì´ë¸” ë¯¸ë°œê²¬ - ìºì‹œ ì €ì¥ ì‹¤íŒ¨');
    }
}, 3000);
```

