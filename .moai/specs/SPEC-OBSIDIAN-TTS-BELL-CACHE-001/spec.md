# SPEC-OBSIDIAN-TTS-BELL-CACHE-001: TTS ì¢…ì†Œë¦¬ ì¬ìƒ ë° ìºì‹œ ê´€ë¦¬ ê¸°ëŠ¥

## íƒœê·¸ ë¸”ë¡

```yaml
tags: [SPEC, TTS, bell, cache, obsidian, audio]
domain: OBSIDIAN
priority: HIGH
status: COMPLETED
created: 2026-02-05
completed: 2026-02-05
```

## í™˜ê²½ (Environment)

**ì‹œìŠ¤í…œ ì»¨í…ìŠ¤íŠ¸:**
- Obsidian í”ŒëŸ¬ê·¸ì¸: TTS (Text-to-Speech) í†µí•© ì‹œìŠ¤í…œ
- ì˜¤ë””ì˜¤ ì—”ì§„: Web Audio API, HTML5 Audio Element
- ìºì‹œ ì‹œìŠ¤í…œ: IndexedDB (ì˜¤í”„ë¼ì¸), Azure Blob Storage (ì„œë²„)
- TTS ì œê³µì: Azure Speech Service (Edge TTS, F0/S0)

**ê´€ë ¨ ì»´í¬ë„ŒíŠ¸:**
- `views/tts-bell/view.js` - ì¢…ì†Œë¦¬ ìƒì„± ë° ì¬ìƒ ë‹´ë‹¹
- `views/tts-engine/view.js` - TTS ì¬ìƒ ì—”ì§„
- `views/tts-cache/view.js` - ìºì‹œ ê´€ë¦¬ (ì˜¤í”„ë¼ì¸/ì„œë²„)
- `views/tts-ui/view.js` - UI ì»´í¬ë„ŒíŠ¸

## ê°€ì • (Assumptions)

**ê¸°ìˆ ì  ê°€ì •:**
1. Web Audio APIê°€ ì§€ì›ë˜ëŠ” ìµœì‹  ë¸Œë¼ìš°ì € í™˜ê²½
2. IndexedDBë¥¼ ì‚¬ìš©í•œ ì˜¤í”„ë¼ì¸ ìºì‹œê°€ ì´ˆê¸°í™”ë˜ì–´ ìˆìŒ
3. ì„œë²„ ìºì‹œ ì—”ë“œí¬ì¸íŠ¸ê°€ ì •ìƒ ë™ì‘ ì¤‘
4. ì¢…ì†Œë¦¬ ì„¤ì •ì´ `ttsBellConfig.enabled = true`ë¡œ í™œì„±í™”ë˜ì–´ ìˆìŒ

**ì‚¬ìš©ì ê°€ì •:**
1. ì‚¬ìš©ìëŠ” í† í”½ ë³€ê²½ ì‹œ ì¢…ì†Œë¦¬ íš¨ê³¼ìŒì„ ê¸°ëŒ€í•¨
2. ìºì‹œëœ ì˜¤ë””ì˜¤ë„ ì¢…ì†Œë¦¬ì™€ í•¨ê»˜ ì¬ìƒë˜ì–´ì•¼ í•¨
3. íŠ¹ì • í† í”½ì˜ ìºì‹œë¥¼ ê°œë³„ ì‚­ì œ/ì¬ìƒì„±í•  ìˆ˜ ìˆì–´ì•¼ í•¨

**ë„ë©”ì¸ ê°€ì •:**
1. í† í”½ ë³€ê²½ = ìƒˆë¡œìš´ ë…¸íŠ¸ ì¬ìƒ ì‹œì‘
2. ì¢…ì†Œë¦¬ëŠ” í† í”½ì˜ ì‹œì‘ ë¶€ë¶„ì—ì„œë§Œ ì¬ìƒë¨

## ìš”êµ¬ì‚¬í•­ (Requirements - EARS Format)

### R1: í† í”½ ë³€ê²½ ì‹œ ì¢…ì†Œë¦¬ ì¬ìƒ (Event-Driven)

**WHEN** ì‚¬ìš©ìê°€ ìƒˆë¡œìš´ í† í”½(ë…¸íŠ¸) ì¬ìƒì„ ì‹œì‘í•  ë•Œ, **THEN** ì‹œìŠ¤í…œì€ ì¢…ì†Œë¦¬ íš¨ê³¼ìŒì„ ì¬ìƒí•´ì•¼ í•œë‹¤.

**ìƒì„¸ ì‚¬ì–‘:**
- [R1.1] ìºì‹œëœ ì˜¤ë””ì˜¤ ì¬ìƒ ì‹œì—ë„ ì¢…ì†Œë¦¬ë¥¼ ì¬ìƒí•´ì•¼ í•¨
- [R1.2] ì¢…ì†Œë¦¬ëŠ” TTS ì˜¤ë””ì˜¤ë³´ë‹¤ ë¨¼ì € ì¬ìƒë˜ì–´ì•¼ í•¨
- [R1.3] ì¢…ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨ ì‹œ TTSë§Œ ì •ìƒ ì¬ìƒë˜ì–´ì•¼ í•¨ (í´ë°±)
- [R1.4] ì¢…ì†Œë¦¬ ë¹„í™œì„±í™” ì„¤ì • ì‹œ í† í”½ë§Œ ë°”ë¡œ ì¬ìƒë˜ì–´ì•¼ í•¨

**ìˆ˜ìš© ê¸°ì¤€:**
- ìºì‹œëœ ì˜¤ë””ì˜¤ ì¬ìƒ ì‹œ ì¢…ì†Œë¦¬ê°€ ë“¤ë ¤ì•¼ í•¨
- ì¢…ì†Œë¦¬ ë³¼ë¥¨ì´ ì„¤ì •ê°’(0.3)ìœ¼ë¡œ ì¬ìƒë˜ì–´ì•¼ í•¨
- ì¢…ì†Œë¦¬ ì§€ì†ì‹œê°„(0.8ì´ˆ) ë‚´ì— TTSê°€ ì‹œì‘ë˜ì–´ì•¼ í•¨

### R2: ìºì‹œì— ìˆœìˆ˜ TTSë§Œ ì €ì¥ (State-Driven)

**IF** TTSê°€ ìƒˆë¡œ ìƒì„±ë˜ë©´, **THEN** ì‹œìŠ¤í…œì€ ìˆœìˆ˜ TTS ì˜¤ë””ì˜¤(ì¢…ì†Œë¦¬ ì—†ìŒ)ë¥¼ ìºì‹œí•´ì•¼ í•œë‹¤.

**ìƒì„¸ ì‚¬ì–‘:**
- [R2.1] ì„œë²„ ìºì‹œì— ìˆœìˆ˜ TTS ì˜¤ë””ì˜¤ë¥¼ ì €ì¥í•´ì•¼ í•¨
- [R2.2] ì˜¤í”„ë¼ì¸ ìºì‹œì—ë„ ìˆœìˆ˜ TTS ì˜¤ë””ì˜¤ë¥¼ ì €ì¥í•´ì•¼ í•¨
- [R2.3] ìºì‹œ ë©”íƒ€ë°ì´í„°ì— `hasBell` í•„ë“œë¥¼ í¬í•¨í•˜ì§€ ì•Šì•„ì•¼ í•¨

**ì„¤ê³„ ì›ì¹™:**
> "ìºì‹œëŠ” ìˆœìˆ˜ TTSë§Œ ì €ì¥, ì¢…ì†Œë¦¬ëŠ” ì¬ìƒ ì‹œì ì—ë§Œ ì¶”ê°€"

### R3: ê°œë³„ ìºì‹œ ì‚­ì œ ê¸°ëŠ¥ (Ubiquitous)

ì‹œìŠ¤í…œì€ ì‚¬ìš©ìê°€ íŠ¹ì • í† í”½ì˜ ìºì‹œë¥¼ ê°œë³„ë¡œ ì‚­ì œí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

**ìƒì„¸ ì‚¬ì–‘:**
- [R3.1] ê° í† í”½(ë…¸íŠ¸) í–‰ì— ìºì‹œ ì‚­ì œ ë²„íŠ¼ì„ ì œê³µí•´ì•¼ í•¨
- [R3.2] ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ í•´ë‹¹ í† í”½ì˜ ì˜¤í”„ë¼ì¸/ì„œë²„ ìºì‹œë¥¼ ëª¨ë‘ ì‚­ì œí•´ì•¼ í•¨
- [R3.3] ì‚­ì œ ì „ ì‚¬ìš©ì í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ í‘œì‹œí•´ì•¼ í•¨
- [R3.4] ì‚­ì œ ì„±ê³µ/ì‹¤íŒ¨ í”¼ë“œë°±ì„ ì‚¬ìš©ìì—ê²Œ ì œê³µí•´ì•¼ í•¨

### R4: ê°œë³„ ìºì‹œ ì¬ìƒì„± ê¸°ëŠ¥ (Event-Driven)

**WHEN** ì‚¬ìš©ìê°€ íŠ¹ì • í† í”½ì˜ ìºì‹œ ì¬ìƒì„±ì„ ìš”ì²­í•  ë•Œ, **THEN** ì‹œìŠ¤í…œì€ í•´ë‹¹ ìºì‹œë¥¼ ì‚­ì œ í›„ ìƒˆë¡œ ìƒì„±í•´ì•¼ í•œë‹¤.

**ìƒì„¸ ì‚¬ì–‘:**
- [R4.1] ê° í† í”½(ë…¸íŠ¸) í–‰ì— ì¬ìƒì„± ë²„íŠ¼ì„ ì œê³µí•´ì•¼ í•¨
- [R4.2] ì¬ìƒì„± ìš”ì²­ ì‹œ ê¸°ì¡´ ìºì‹œë¥¼ ì‚­ì œí•˜ê³  TTSë¥¼ ìƒˆë¡œ ìƒì„±í•´ì•¼ í•¨
- [R4.3] ì¬ìƒì„± ì¤‘ì—ëŠ” ë¡œë”© í‘œì‹œë¥¼ í•´ì•¼ í•¨
- [R4.4] ì¬ìƒì„± ì™„ë£Œ í›„ ìë™ ì¬ìƒì„ ì‹œì‘í•´ì•¼ í•¨ (ì‚¬ìš©ì ì„¤ì • ì‹œ)

### R5: UI í†µí•© (Ubiquitous)

ì‹œìŠ¤í…œì€ ìºì‹œ ê´€ë¦¬ UIë¥¼ TTS ë…¸íŠ¸ ëª©ë¡ì— í†µí•©í•´ì•¼ í•œë‹¤.

**ìƒì„¸ ì‚¬ì–‘:**
- [R5.1] ê° ë…¸íŠ¸ í–‰ì— ìºì‹œ ìƒíƒœ ì•„ì´ì½˜ì„ í‘œì‹œí•´ì•¼ í•¨
- [R5.2] ìºì‹œ ìƒíƒœ: ì—†ìŒ(íšŒìƒ‰), ì˜¤í”„ë¼ì¸ë§Œ(íŒŒë‘), ì„œë²„+ì˜¤í”„ë¼ì¸(ì´ˆë¡)
- [R5.3] ìºì‹œ ê´€ë¦¬ ë²„íŠ¼(ì‚­ì œ/ì¬ìƒì„±)ì„ íˆ´íŒì´ë‚˜ ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ ì œê³µí•´ì•¼ í•¨
- [R5.4] ëŒ€ëŸ‰ ì‘ì—…ì„ ìœ„í•œ ì „ì²´ ì„ íƒ ê¸°ëŠ¥ì„ ì œê³µí•´ì•¼ í•¨

### R6: ì˜¤í”„ë¼ì¸/ì—ì§€ ì„œë²„ ëª¨ë“œ ì§€ì› (State-Driven)

**IF** ì‹œìŠ¤í…œì´ ì˜¤í”„ë¼ì¸ ëª¨ë“œ ë˜ëŠ” ì—ì§€ ì„œë²„ ëª¨ë“œì´ë©´, **THEN** ìºì‹œ ê´€ë¦¬ ê¸°ëŠ¥ì´ ì •ìƒ ë™ì‘í•´ì•¼ í•œë‹¤.

**ìƒì„¸ ì‚¬ì–‘:**
- [R6.1] ì˜¤í”„ë¼ì¸ ëª¨ë“œì—ì„œ ì˜¤í”„ë¼ì¸ ìºì‹œë§Œ ì‚­ì œ/ì¬ìƒì„±í•´ì•¼ í•¨
- [R6.2] ë¡œì»¬ ëª¨ë“œì—ì„œëŠ” ì„œë²„ ìºì‹œ ì‘ì—…ì„ ìŠ¤í‚µí•´ì•¼ í•¨
- [R6.3] ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì ì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•´ì•¼ í•¨

## ê¸°ìˆ ì  ì‚¬ì–‘ (Technical Specifications)

### ì¢…ì†Œë¦¬ ì¬ìƒ ì•„í‚¤í…ì²˜

**í•µì‹¬ ì›ì¹™:**
> "ìºì‹œëŠ” ìˆœìˆ˜ TTSë§Œ ì €ì¥, ì¢…ì†Œë¦¬ëŠ” ì¬ìƒ ì‹œì ì—ë§Œ ì¶”ê°€"

**êµ¬í˜„:**
```javascript
// views/tts-engine/view.js:1268
if (window.playTTSWithBellSequential) {
    try {
        await window.playTTSWithBellSequential(audioBlob, reader.audioElement);
    } catch (bellError) {
        console.warn('âš ï¸ ì¢…ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨, TTSë§Œ ì¬ìƒ:', bellError.message);
        // í´ë°±: TTSë§Œ ì¬ìƒ
        reader.audioElement.src = URL.createObjectURL(audioBlob);
        await reader.audioElement.play();
    }
}
```

### ìºì‹œ ìŠ¤í‚¤ë§ˆ

**ì˜¤í”„ë¼ì¸ ìºì‹œ (IndexedDB):**
```javascript
{
    cacheKey: string,        // "noteHash-contentHash-versionHash"
    audioBlob: Blob,         // ìˆœìˆ˜ TTS ì˜¤ë””ì˜¤ ë°ì´í„°
    notePath: string,        // ë…¸íŠ¸ íŒŒì¼ ê²½ë¡œ
    timestamp: number,       // ì €ì¥ ì‹œê°„
    size: number             // íŒŒì¼ í¬ê¸°
    // hasBell í•„ë“œ ì œê±°ë¨
}
```

### UI ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

**ë…¸íŠ¸ í–‰ ì¶”ê°€ ìš”ì†Œ:**
```html
<div class="note-row" id="note-row-{index}">
    <span class="note-name">{page.file.name}</span>
    <span class="cache-status" data-cache-key="{cacheKey}">
        <span class="cache-icon">ğŸ’¾</span>
    </span>
    <div class="cache-actions">
        <button class="delete-cache-btn" title="ìºì‹œ ì‚­ì œ">ğŸ—‘ï¸</button>
        <button class="regenerate-cache-btn" title="ìºì‹œ ì¬ìƒì„±">ğŸ”„</button>
    </div>
</div>
```

## ì œì•½ì‚¬í•­ (Constraints)

**ê¸°ìˆ ì  ì œì•½:**
1. Web Audio APIì˜ OscillatorëŠ” ì‹¤ì‹œê°„ í•©ì„±ì´ë¯€ë¡œ ìºì‹œì— ë¯¸ë¦¬ ì €ì¥ ë¶ˆê°€
2. ì¢…ì†Œë¦¬ëŠ” ì¬ìƒ ì‹œì ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒì„±ë¨
3. IndexedDB ìºì‹œ ìŠ¤í‚¤ë§ˆê°€ ë‹¨ìˆœí™”ë¨ (`hasBell` ì œê±°)

**ì‚¬ìš©ì ê²½í—˜ ì œì•½:**
1. ìºì‹œ ì¬ìƒì„± ì‹œ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ìœ¼ë¡œ ì¸í•œ ì§€ì—° ë°œìƒ
2. ëŒ€ëŸ‰ ì¬ìƒì„± ì‹œ API í• ë‹¹ëŸ‰ ì†Œëª¨

**ì„±ëŠ¥ ì œì•½:**
1. ì¢…ì†Œë¦¬ ì‹¤ì‹œê°„ ìƒì„±ì— < 50ms ì†Œìš”
2. ëŒ€ëŸ‰ ìºì‹œ ì‚­ì œ ì‹œ ë¸Œë¼ìš°ì € ì‘ë‹µ ì§€ì—° ê°€ëŠ¥ì„±

## ì˜ì¡´ì„± (Dependencies)

**í•„ìˆ˜ ëª¨ë“ˆ:**
- `views/tts-bell/view.js` - ì¢…ì†Œë¦¬ ìƒì„± í•¨ìˆ˜
- `views/tts-engine/view.js` - TTS ì¬ìƒ ì—”ì§„
- `views/tts-cache/view.js` - ìºì‹œ ê´€ë¦¬ì
- `views/tts-ui/view.js` - UI ë Œë”ë§

**ì„ íƒì  ëª¨ë“ˆ:**
- `views/tts-config/view.js` - ì„¤ì • ê´€ë¦¬

## ì¶”ì ì„± (Traceability)

**ìš”êµ¬ì‚¬í•­-ì»´í¬ë„ŒíŠ¸ ë§¤í•‘:**
- R1, R2: `views/tts-engine/view.js::speakNoteWithServerCache()`
- R3, R4: `views/tts-cache/view.js::deleteAudio()`, `regenerateAudio()`
- R5: `views/tts-ui/view.js::renderNoteRow()`
- R6: `views/tts-cache/view.js::getCachedAudioFromServer()`

**í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:**
- R1: ìºì‹œëœ ë…¸íŠ¸ ì¬ìƒ ì‹œ ì¢…ì†Œë¦¬ í™•ì¸
- R2: ìˆœìˆ˜ TTS ìºì‹œ ì €ì¥ í™•ì¸
- R3: ê°œë³„ ìºì‹œ ì‚­ì œ ë™ì‘ í™•ì¸
- R4: ê°œë³„ ìºì‹œ ì¬ìƒì„± ë™ì‘ í™•ì¸
- R5: UI ë²„íŠ¼ ë™ì‘ ë° í”¼ë“œë°± í™•ì¸
- R6: ì˜¤í”„ë¼ì¸ ëª¨ë“œì—ì„œ ìºì‹œ ê´€ë¦¬ í™•ì¸

## êµ¬í˜„ ìƒíƒœ (Implementation Status)

| ìš”êµ¬ì‚¬í•­ | ìƒíƒœ | ì™„ë£Œì¼ | ë¹„ê³  |
|----------|------|--------|------|
| R1: ì¢…ì†Œë¦¬ ì¬ìƒ | âœ… ì™„ë£Œ | 2026-02-05 | ëª¨ë“  ìºì‹œëœ ì˜¤ë””ì˜¤ì— ì ìš© |
| R2: ìˆœìˆ˜ TTS ìºì‹± | âœ… ì™„ë£Œ | 2026-02-05 | `hasBell` í•„ë“œ ì œê±° |
| R3: ê°œë³„ ìºì‹œ ì‚­ì œ | âœ… ì™„ë£Œ | 2026-02-05 | UI êµ¬í˜„ ì™„ë£Œ |
| R4: ê°œë³„ ìºì‹œ ì¬ìƒì„± | âœ… ì™„ë£Œ | 2026-02-05 | UI êµ¬í˜„ ì™„ë£Œ |
| R5: UI í†µí•© | âœ… ì™„ë£Œ | 2026-02-05 | ìºì‹œ ìƒíƒœ ì•„ì´ì½˜ |
| R6: ëª¨ë“œ ì§€ì› | âœ… ì™„ë£Œ | 2026-02-05 | ì˜¤í”„ë¼ì¸/ë¡œì»¬ ëª¨ë“œ |

## ë¬¸ì„œ (Documentation)

- **CHANGELOG**: [docs/CHANGELOG.md](./docs/CHANGELOG.md)
- **ì•„í‚¤í…ì²˜**: [docs/architecture.md](./docs/architecture.md)
- **ìˆ˜ìš© ê¸°ì¤€**: [acceptance.md](./acceptance.md)
- **êµ¬í˜„ ê³„íš**: [plan.md](./plan.md)
