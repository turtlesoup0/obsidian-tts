# SPEC-OBSIDIAN-TTSV5-SYNC-001

## Metadata

- **ID**: SPEC-OBSIDIAN-TTSV5-SYNC-001
- **Title**: TTS v5 μ¬μƒλ‚΄μ—­ λ””λ°”μ΄μ¤ κ°„ λ™κΈ°ν™” λ° μ¬μƒ μ»¨νΈλ΅¤ κ°μ„ 
- **Created**: 2026-02-04
- **Status**: Planned
- **Priority**: High
- **Assigned**: manager-ddd

---

## Environment

### κΈ°μ  μ¤νƒ

- **ν”„λ΅ νΈμ—”λ“**: Obsidian DataviewJS, Vanilla JavaScript
- **μ¤ν† λ¦¬μ§€**:
  - LocalStorage (λ΅μ»¬ μƒνƒ)
  - IndexedDB (μ¤ν”„λΌμΈ μΊμ‹)
  - Azure Blob Storage (μ¤λ””μ¤ μΊμ‹)
  - Azure Function API (μ¬μƒ μ„μΉ λ™κΈ°ν™”)
- **TTS**: Azure Cognitive Services Speech API, Edge TTS (λ΅μ»¬)

### κ΄€λ ¨ νμΌ

- `views/tts-engine/view.js`: TTS μ¬μƒ μ—”μ§„ (azureTTSPlay, azureTTSPause)
- `views/tts-position/view.js`: μ¬μƒ μ„μΉ λ™κΈ°ν™” (playbackPositionManager)
- `views/tts-ui/view.js`: UI μƒμ„± λ° λ²„νΌ μ»¨νΈλ΅¤
- `views/tts-cache/view.js`: μΊμ‹ κ΄€λ¦¬ (offlineCacheManager, serverCacheManager)

---

## Assumptions

1. **λ„¤νΈμ›ν¬ κ°€μ©μ„±**: μ„λ²„ λ™κΈ°ν™” κΈ°λ¥μ΄ μ¨λΌμΈ μƒνƒμ—μ„ μ •μƒ μ‘λ™ν•λ‹¤κ³  κ°€μ •
2. **Azure Function μ•μ •μ„±**: μ¬μƒ μ„μΉ API endpointκ°€ μ•μ •μ μΌλ΅ μ‘λ‹µν•λ‹¤κ³  κ°€μ •
3. **LocalStorage μ§€μ›**: λ¨λ“  νƒ€κ² λ””λ°”μ΄μ¤μ—μ„ LocalStorageκ°€ μ§€μ›λλ‹¤κ³  κ°€μ •
4. **λ‹¨μΌ μ‚¬μ©μ**: ν•λ‚μ μ‚¬μ©μκ°€ μ—¬λ¬ λ””λ°”μ΄μ¤μ—μ„ μ‚¬μ©ν•λ” μ‹λ‚λ¦¬μ¤λ¥Ό κ°€μ •
5. **λ…ΈνΈ λ¦¬μ¤νΈ μ•μ •μ„±**: Dataview μΏΌλ¦¬λ΅ κ°€μ Έμ¨ λ…ΈνΈ λ¦¬μ¤νΈμ μμ„κ°€ λ¨λ“  λ””λ°”μ΄μ¤μ—μ„ λ™μΌν•λ‹¤κ³  κ°€μ •

---

## Requirements

### R1: μ¬μƒλ‚΄μ—­ λ””λ°”μ΄μ¤ κ°„ μ‹¤μ‹κ°„ λ™κΈ°ν™” (Priority: High)

**EARS Format**: WHEN μ‚¬μ©μκ°€ μ–΄λ–¤ λ””λ°”μ΄μ¤μ—μ„ TTSλ¥Ό μ¬μƒν•λ©΄, THEN μ‹μ¤ν…μ€ ν•΄λ‹Ή μ¬μƒ μ„μΉλ¥Ό μ„λ²„μ— μ¦‰μ‹ μ €μ¥ν•κ³ , λ‹¤λ¥Έ λ””λ°”μ΄μ¤μ—μ„ μ¬μƒ μ‹μ‘ μ‹ μµμ‹  μ„μΉλ¥Ό μ΅°νν•μ—¬ λ³µμ›ν•΄μ•Ό ν•λ‹¤.

**μƒμ„Έ μ”κµ¬μ‚¬ν•­**:
- R1.1: μ¬μƒ μ‹μ‘ μ‹ μ„λ²„μ—μ„ μµμ‹  μ¬μƒ μ„μΉ μ΅°ν
- R1.2: λ…ΈνΈ μ¬μƒ μ¤‘ ν„μ¬ μΈλ±μ¤λ¥Ό μ‹¤μ‹κ°„μΌλ΅ μ„λ²„μ— μ „μ†΅
- R1.3: νƒ€μ„μ¤νƒ¬ν”„ κΈ°λ° μ¶©λ ν•΄μ† (μµμ‹  νƒ€μ„μ¤νƒ¬ν”„ μ°μ„ )
- R1.4: λ””λ°”μ΄μ¤ IDλ¥Ό ν™μ©ν• λ™κΈ°ν™” μ¶μ² μ¶”μ 
- R1.5: μ„λ²„ ν†µμ‹  μ‹¤ν¨ μ‹ λ΅μ»¬ μƒνƒλ΅ ν΄λ°±

### R2: λ§μ§€λ§‰ μ¬μƒ λ…ΈνΈ μλ™ μ‹¤ν–‰ (Priority: High)

**EARS Format**: WHEN μ‚¬μ©μκ°€ μ¬μƒ λ²„νΌμ„ λ„λ¥΄λ©΄, THEN μ‹μ¤ν…μ€ κ°€μ¥ λ§μ§€λ§‰μ— μ¬μƒλ λ…ΈνΈ(λλ” κ·Έ λ‹¤μ λ…ΈνΈ)λ¥Ό μλ™μΌλ΅ μ¬μƒν•΄μ•Ό ν•λ‹¤.

**μƒμ„Έ μ”κµ¬μ‚¬ν•­**:
- R2.1: `azureTTSPlay()` νΈμ¶ μ‹ λ§μ§€λ§‰ μ¬μƒ μΈλ±μ¤ ν™•μΈ
- R2.2: λ§μ§€λ§‰ λ…ΈνΈ μ¬μƒ μ™„λ£ ν›„ λ‹¤μ λ…ΈνΈ μλ™ μ‹μ‘
- R2.3: λ¨λ“  λ…ΈνΈ μ¬μƒ μ™„λ£ μ‹ μ²μλ¶€ν„° μ¬μƒ
- R2.4: μ‚¬μ©μκ°€ μλ™μΌλ΅ νΉμ • λ…ΈνΈλ¥Ό μ„ νƒν• κ²½μ° ν•΄λ‹Ή λ…ΈνΈ μ°μ„ 
- R2.5: μλ™ μ‹¤ν–‰ μ‹¤ν¨ μ‹ μ‚¬μ©μμ—κ² λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€ ν‘μ‹

### R3: μ¬μƒ/μΌμ‹μ •μ§€ λ²„νΌ ν†µν•© (Priority: Medium)

**EARS Format**: THE μ‹μ¤ν…μ€ μ¬μƒκ³Ό μΌμ‹μ •μ§€ κΈ°λ¥μ„ ν•λ‚μ ν† κΈ€ λ²„νΌμΌλ΅ ν†µν•©ν•΄μ•Ό ν•λ‹¤.

**μƒμ„Έ μ”κµ¬μ‚¬ν•­**:
- R3.1: λ‹¨μΌ λ²„νΌμΌλ΅ ν„μ¬ μƒνƒμ— λ”°λΌ μ¬μƒ/μΌμ‹μ •μ§€ ν† κΈ€
- R3.2: λ²„νΌ ν…μ¤νΈμ™€ μ•„μ΄μ½μ„ μƒνƒμ— λ”°λΌ λ™μ  λ³€κ²½
  - μ •μ§€/μΌμ‹μ •μ§€ μƒνƒ: "β–¶οΈ μ¬μƒ" ν‘μ‹
  - μ¬μƒ μ¤‘ μƒνƒ: "βΈοΈ μΌμ‹μ •μ§€" ν‘μ‹
- R3.3: λ²„νΌ μƒ‰μƒμ„ μƒνƒμ— λ”°λΌ λ³€κ²½ (μ΄λ΅μƒ‰/μ£Όν™©μƒ‰)
- R3.4: λ΅λ”© μ¤‘ μƒνƒ μ‹ λ²„νΌ λΉ„ν™μ„±ν™” λ° μ¤ν”Όλ„ ν‘μ‹
- R3.5: κΈ°μ΅΄ λ³„λ„ λ²„νΌ μ μ§€ (ν•μ„ νΈν™μ„±)

### R4: μ¬μƒ μƒνƒ UI κ°μ„  (Priority: Medium)

**EARS Format**: THE μ‹μ¤ν…μ€ ν„μ¬ μ¬μƒ μƒνƒλ¥Ό μ‚¬μ©μμ—κ² λ…ν™•ν•κ² ν‘μ‹ν•΄μ•Ό ν•λ‹¤.

**μƒμ„Έ μ”κµ¬μ‚¬ν•­**:
- R4.1: λ§μ§€λ§‰ μ¬μƒ μ •λ³΄ ν‘μ‹ μμ—­ κ°μ„ 
- R4.2: λ™κΈ°ν™” μƒνƒ ν‘μ‹ (λ΅μ»¬/μ„λ²„/λ™κΈ°ν™” μ¤‘)
- R4.3: μ¬μƒ μ¤‘μΈ λ…ΈνΈ κ°•μ΅° ν‘μ‹
- R4.4: λ‹¤μ μ¬μƒ μμ • λ…ΈνΈ λ―Έλ¦¬λ³΄κΈ°

---

## Specifications

### S1: μ¬μƒ μ„μΉ λ™κΈ°ν™” κ°μ„ 

**ν„μ¬ κµ¬ν„ λ¶„μ„**:
- `playbackPositionManager.syncPosition()`μ΄ νƒ€μ„μ¤νƒ¬ν”„ λΉ„κµλ΅ λ™κΈ°ν™” μν–‰
- λ¬Έμ μ : λ…ΈνΈ μ¬μƒ μ¤‘ μ‹¤μ‹κ°„ λ™κΈ°ν™”κ°€ λ¶€μ΅±ν•¨

**κ°μ„  λ°©μ•**:
1. `speakNoteWithServerCache()` ν•¨μ λ‚΄μ—μ„ μ¬μƒ μ‹μ‘ μ‹ μ¦‰μ‹ μ„λ²„μ— μ €μ¥
2. λ…ΈνΈ λ³€κ²½ μ‹λ§λ‹¤ `savePosition()` νΈμ¶
3. νμ΄μ§€ λ΅λ“ μ‹ `getPosition()`μΌλ΅ μµμ‹  μ„μΉ ν™•μΈ

### S2: μλ™ μ¬μƒ λ΅μ§ κ°•ν™”

**ν„μ¬ κµ¬ν„ λ¶„μ„**:
- `azureTTSPlay()`κ°€ `syncedIndex + 1`λ¶€ν„° μ¬μƒ
- λ¬Έμ μ : λ§μ§€λ§‰ μ¬μƒ λ…ΈνΈ μλ™ μ‹¤ν–‰μ΄ λ…ν™•ν•μ§€ μ•μ

**κ°μ„  λ°©μ•**:
1. `syncPosition()` ν›„ λ§μ§€λ§‰ μ¬μƒ λ…ΈνΈλ¥Ό μ¦‰μ‹ μ¬μƒ
2. λ§μ§€λ§‰ λ…ΈνΈκ°€ μ΄λ―Έ μ¬μƒ μ™„λ£λ κ²½μ° λ‹¤μ λ…ΈνΈ μλ™ μ‹μ‘
3. UI ν‘μ‹: "λ§μ§€λ§‰ μ¬μƒ: [5]λ² λ…ΈνΈ - κ³„μ† μ¬μƒν•©λ‹λ‹¤"

### S3: ν†µν•© μ¬μƒ/μΌμ‹μ •μ§€ λ²„νΌ

**κµ¬ν„ λ°©μ•**:
1. `azureTTSTogglePlayPause()` ν•¨μ μ¶”κ°€
2. `azureTTSReader.isPaused`, `audioElement.paused` μƒνƒ ν™•μΈ
3. λ²„νΌ UI λ™μ  μ—…λ°μ΄νΈ
4. κΈ°μ΅΄ `playBtn`, `pauseBtn` μ μ§€ν•λ©° μƒλ΅μ΄ ν† κΈ€ λ²„νΌ μ¶”κ°€

### S4: UI/UX κ°μ„ 

**κµ¬ν„ λ°©μ•**:
1. `last-played-info` μμ—­ κ°μ„ 
2. λ™κΈ°ν™” μƒνƒ ν‘μ‹ μ¶”κ°€ (π”„ μ•„μ΄μ½)
3. μ¬μƒ μ¤‘μΈ λ…ΈνΈ ν…μ΄λΈ” ν–‰ κ°•μ΅° (λ°°κ²½μƒ‰)
4. λ‹¤μ μ¬μƒ λ…ΈνΈ λ―Έλ¦¬λ³΄κΈ°

---

## Traceability

| Requirement | Specification | Files Affected |
|-------------|---------------|----------------|
| R1 | S1 | views/tts-engine/view.js, views/tts-position/view.js |
| R2 | S2 | views/tts-engine/view.js |
| R3 | S3 | views/tts-ui/view.js |
| R4 | S4 | views/tts-ui/view.js |

---

## TAGS

```
#spec #obsidian #tts #synchronization #ui-improvement #v5.3.0
```
